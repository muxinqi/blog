{"componentChunkName":"component---src-templates-blog-post-js","path":"/archives/android-high-version-http-request-error-cause/","result":{"data":{"site":{"siteMetadata":{"title":"Mu Xinqi's Blog"}},"markdownRemark":{"id":"704130af-9a9f-5254-a3fe-b04bb4ec4180","excerpt":"在 Android 7(API 24)上正常，但在 Android 10(API 29) 上 Volley 请求 http 失败，所以不显示内容。 查询到 Android Pie 行为变更中提到： 传输层安全协议 (TLS) 实现变更 系统的传输层安全协议 (TLS) 实现在 Android…","html":"<p>在 Android 7(API 24)上正常，但在 Android 10(API 29) 上 Volley 请求 http 失败，所以不显示内容。</p>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/9ae6c/before-fix.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 62.65822784810127%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/svg+xml,%3csvg%20xmlns=\\&apos;http://www.w3.org/2000/svg\\&apos;%20width=\\&apos;400\\&apos;%20height=\\&apos;251\\&apos;%20viewBox=\\&apos;0%200%20400%20251\\&apos;%20preserveAspectRatio=\\&apos;none\\&apos;%3e%3cpath%20d=\\&apos;M230%2011c-6%204-6%202-6%2074v65h-17l-17%201-7%201h-7l6-1%207-1h-7l-7%201h-1l-2-66c0-71%200-70-7-73-5-3-93-3-97%200-7%204-6%200-7%2075%200%2060-1%2071-2%2060-1-2-1-1-1%202%200%206%200%207-3%206l-1-4c0-3-1-4-2-4-2-1-2-1-2%204l-1%204-1-2v-3H28l-20-1-4-1H0v103h401v-42l-1-62v-19h-4l-4%201-14%202-16%201c-2%200-3%200-3-2-1-2-1-2-1%202v5l-1-4c-1-4-1-4-1-1l-2%204-1%206%201%207h-18v-6a37988%2037988%200%2001-2-122c-3-13%200-12-55-12-44%200-46%200-49%202m-1%20121v84h101V47H229v85M66%2049v85l1%2083h100V48h-50l-51%201M0%20200\\&apos;%20fill=\\&apos;%23d3d3d3\\&apos;%20fill-rule=\\&apos;evenodd\\&apos;/%3e%3c/svg%3e&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/e10e9/before-fix.webp 158w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/7600a/before-fix.webp 315w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/d869c/before-fix.webp 630w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/38d5d/before-fix.webp 945w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/4eefe/before-fix.webp 1260w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/a0280/before-fix.webp 2934w\" sizes=\"(max-width: 630px) 100vw, 630px\" type=\"image/webp\">\n        <source srcset=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/ff44c/before-fix.jpg 158w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/a6688/before-fix.jpg 315w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/828fb/before-fix.jpg 630w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/0ede0/before-fix.jpg 945w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/3ac88/before-fix.jpg 1260w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/9ae6c/before-fix.jpg 2934w\" sizes=\"(max-width: 630px) 100vw, 630px\" type=\"image/jpeg\">\n        <img class=\"gatsby-resp-image-image\" src=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/27c7eb9d6fd047b1d4b80829a18a296d/828fb/before-fix.jpg\" alt=\"request_http_failed_in_high_version\" title=\"request_http_failed_in_high_version\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span>\n<p>查询到 <a href=\"https://developer.android.com/about/versions/pie/android-9.0-changes-all?hl=zh-cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Android Pie 行为变更</a>中提到：</p>\n<blockquote>\n<p><strong>传输层安全协议 (TLS) 实现变更</strong></p>\n<p>系统的传输层安全协议 (TLS) 实现在 Android 9 中经历了若干次变更：</p>\n<ul>\n<li>如果 <a href=\"https://developer.android.com/reference/javax/net/ssl/SSLSocket.html?hl=zh-cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SSLSocket</a> 的实例在创建时连接失败，系统会引发 <a href=\"https://developer.android.com/reference/java/io/IOException.html?hl=zh-cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">IOException</a> 而非 <a href=\"https://developer.android.com/reference/java/lang/NullPointerException.html?hl=zh-cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">NullPointerException</a>。</li>\n<li><a href=\"https://developer.android.com/reference/javax/net/ssl/SSLEngine.html?hl=zh-cn\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">SSLEngine</a> 类可正常处理出现的任何 <code class=\"language-text\">close_notify</code> 提醒。</li>\n</ul>\n<p>如需了解有关在 Android 应用中进行安全网络请求的更多信息，请参阅 <a href=\"https://developer.android.com/training/articles/security-ssl?hl=zh-cn#HttpsExample\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">一个 HTTPS 示例</a> 。</p>\n</blockquote>\n<br/>\n<h2>解决方法</h2>\n<ol>\n<li>改用 https 请求 （推荐）</li>\n<li><code class=\"language-text\">targetSdkVersion</code> 改为 <code class=\"language-text\">27</code> 以下</li>\n<li>\n<p>在 <code class=\"language-text\">AnroidManifest.xml</code> 中的 <code class=\"language-text\">&lt;application&gt;</code> 标签中添加</p>\n<p> <code class=\"language-text\">android:usesCleartextTraffic=“true”</code></p>\n</li>\n<li>\n<p>在 <code class=\"language-text\">res/xml</code> 目录下创建 <code class=\"language-text\">network_security_config.xml</code> 文件，</p>\n<p>然后在 <code class=\"language-text\">AndroidManifest.xml</code> 中的 <code class=\"language-text\">&lt;application&gt;</code> 标签中添加</p>\n<p><code class=\"language-text\">android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</code>。</p>\n</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!--network_security_config.xml--></span>\n\n<span class=\"token prolog\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>network-security-config</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!--默认配置，明文通信，使用系统证书--></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>base-config</span> <span class=\"token attr-name\">cleartextTrafficPermitted</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>trust-anchors</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>certificates</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>system<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>trust-anchors</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>base-config</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>network-security-config</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<br/>\n<h2>按照第三条修改后：</h2>\n<span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/d3e24/after-fix.jpg\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 64.55696202531645%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/svg+xml,%3csvg%20xmlns=\\&apos;http://www.w3.org/2000/svg\\&apos;%20width=\\&apos;400\\&apos;%20height=\\&apos;258\\&apos;%20viewBox=\\&apos;0%200%20400%20258\\&apos;%20preserveAspectRatio=\\&apos;none\\&apos;%3e%3cpath%20d=\\&apos;M237%2012c-6%205-6%202-7%2078a3271%203271%200%2001-2%2062v-3l-1%204-1%205v-6c0-6-2-7-2-1v3h-8c-7%200-8%200-8-2l-1-2-1%202c0%202-3%205-4%203l-2-2-1-4%201-3v3c0%204%202%204%202-1%200-3%200-4-2-4s-2%201-2%204v5l-1-5-1-4v4l1%206c1%201%202%202%201%203s-1%201-1-1v-2l-2%202c-1%202-3%202-7%202h-5l5-1%205-1h-6l-5%201h-1c-1-1-1-1-1%201-1%201-1%201-1-1v-2l-1%202-1-66c0-67%200-68-2-72-4-8-2-8-55-8-52%200-51%200-54%207a1180%201180%200%2000-4%20138c0-5-2-5-2%200-1%204-1%203-1-2v-7l-1%207c0%205-1%205-1%202%200-4%200-4-2-4l-3%201-26%201H0v104h401v-42l-1-63v-20h-8c-6%200-8%200-8%202s-16%202-16-1h-1l-1%202-1%204c0%203%200%203-1-2s-1-4-1%205v11h-9c-8%200-8-1-9-3V85c-1-59-1-64-3-68-3-7-2-7-55-7h-47l-3%202m-1%20124v87h103V49H236v87m-167%201v87h103V50H69v87M0%20206\\&apos;%20fill=\\&apos;%23d3d3d3\\&apos;%20fill-rule=\\&apos;evenodd\\&apos;/%3e%3c/svg%3e&apos;); background-size: cover; display: block;\"></span>\n  <picture>\n        <source srcset=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/e10e9/after-fix.webp 158w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/7600a/after-fix.webp 315w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/d869c/after-fix.webp 630w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/38d5d/after-fix.webp 945w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/4eefe/after-fix.webp 1260w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/f50bd/after-fix.webp 2862w\" sizes=\"(max-width: 630px) 100vw, 630px\" type=\"image/webp\">\n        <source srcset=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/ff44c/after-fix.jpg 158w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/a6688/after-fix.jpg 315w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/828fb/after-fix.jpg 630w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/0ede0/after-fix.jpg 945w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/3ac88/after-fix.jpg 1260w,\nhttps://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/d3e24/after-fix.jpg 2862w\" sizes=\"(max-width: 630px) 100vw, 630px\" type=\"image/jpeg\">\n        <img class=\"gatsby-resp-image-image\" src=\"https://cdn.jsdelivr.net/gh/muxinqi/blog@v-1610289478273/static/5b2db16bc4abc6cc40d6aab8ad188258/828fb/after-fix.jpg\" alt=\"after\" title=\"after\" loading=\"lazy\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\">\n      </picture>\n  </a>\n    </span>","frontmatter":{"title":"Android高版本http请求错误","date":"December 08, 2019","description":"📕 Android 开发中遇到的问题"}},"previous":{"fields":{"slug":"/archives/getting-started-with-fitness/"},"frontmatter":{"title":"在疫情期间我坚持下来的事","slug":"getting-started-with-fitness"}},"next":{"fields":{"slug":"/archives/notes-of-getting-started-with-android-development/"},"frontmatter":{"title":"Android高版本权限问题","slug":"notes-of-getting-started-with-android-development"}}},"pageContext":{"id":"704130af-9a9f-5254-a3fe-b04bb4ec4180","previousPostId":"732ca6ad-b9f8-511a-a041-53c25c670234","nextPostId":"632eaf3a-b6a8-572e-93e8-1200d97e2dc4"}},"staticQueryHashes":["2841359383","916993862"]}